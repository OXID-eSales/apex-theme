{% set actCategory = oView.getActiveCategory() %}
{% set showPopBreadcrump = oViewConf.getViewThemeParam('sShowPopBreadcrump') %}
{% set oPageNavigation = oView.getPageNavigation() %}
{% set sCategoryDescPosition = oViewConf.getViewThemeParam('sCategoryDescPosition') %}

{% capture append = "oxidBlock_sidebar" %}
    {% set listType = oView.getListType() %}
    {% if listType=='manufacturer' or listType=='vendor' %}
        {% if actCategory and actCategory.getIconUrl() %}
        <div class="box">
            <h3>
                {% if listType=='manufacturer' %}
                    {{ translate({ ident: "BRAND" }) }}
                {% elseif listType=='vendor' %}
                    {{ translate({ ident: "VENDOR" }) }}
                {% endif %}
            </h3>
            <div class="featured icon">
                <img loading="lazy" src="{{ actCategory.getIconUrl() }}" alt="{{ actCategory.getTitle() }}">
            </div>
        </div>
        {% endif %}
    {% endif %}
{% endcapture %}

{% capture append = "oxidBlock_content" %}
    {% block page_list_listhead %}
    {% if listType=='manufacturer' %}
        <div class="bg-light position-relative manufacturer-header">
            <div class="container-xxl">
                <div class="d-flex justify-content-between py-3 py-md-5">
                    <div class="manufacturer-infos pe-5">
                        <h1{% if actCategory.oxcategories__oxthumb.value and actCategory.getThumbUrl() %} class="text-white"{% endif %}>
                            {{ actCategory.getTitle() }}
                        </h1>
                        {% if actCategory and actCategory.getShortDescription() and oPageNavigation.actPage == 1 and actCategory.oxcategories__oxdesc.rawValue %}
                        <div id="catDescLocator" class="categoryDescription">
                            {{ actCategory.oxcategories__oxdesc.rawValue }}
                        </div>
                        {% endif %}
                    </div>
                    {% if actCategory.getIconUrl() %}
                        <img src="{{ actCategory.getIconUrl() }}">
                    {% endif %}
                </div>
            </div>

            {% if showPopBreadcrump %}
            <div class="breadcrumb-wrapper">
                <div class="container-xxl pt-3">
                    {% include "widget/breadcrumb.html.twig" %}
                </div>
            </div>
            {% endif %}
        </div>
    {% else %}
        {% if headerImageWidth == 'container' %}
            <div class="container-xxl">
        {% endif %}

        <div class="position-relative{% if actCategory.oxcategories__oxthumb.value and actCategory.getThumbUrl() %} bg-dark pop-img{% else %} no-img{% endif %}">
            {% if actCategory.oxcategories__oxthumb.value and actCategory.getThumbUrl() %}
                {% set headerImageWidth = oViewConf.getViewThemeParam('sHeaderImageWidth') %}
                {% set headerImageheight = oViewConf.getViewThemeParam('sHeaderImageHeight') %}
                {% set height = 1 %}

                {% if headerImageheight == 'small' %}
                    {% set height = 0.5 %}
                {% endif %}

                {% set height375 = height*220 %}
                {% set height750 = height*350 %}
                {% set height970 = height*400 %}
                {% set height1170 = height*400 %}
                {% set height1400 = height*450 %}
                {% set height1600 = height*500 %}
                {% set height1800 = height*600 %}

                {% if oViewConf.isModuleActive('cnc / imagebutler') %}
                    <picture class="d-block">
                        <source type="image/webp" srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 375, height375, 'webp', false) }}" media="(max-width: 375px)">

                        <source type="image/webp" srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 750, height750, 'webp', false) }}" media="(max-width: 767px)">
                        <source srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 750, height750, 'jpg', false) }}" media="(max-width: 767px)">

                        <source type="image/webp" srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 970, height970, 'webp', false) }}" media="(max-width: 991px)">
                        <source srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 970, height970, 'jpg', false) }}" media="(max-width: 991px)">

                        <source type="image/webp" srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1170, height1170, 'webp', false) }}" media="(max-width: 1199px)">
                        <source srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1170, height1170, 'jpg', false) }}" media="(max-width: 1199px)">

                        {% if headerImageWidth == 'w100c100' %}
                        <source type="image/webp" srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1400, height1400, 'webp', false) }}" media="(max-width: 1399px)">
                        <source srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1400, height1400, 'jpg', false) }}" media="(max-width: 1399px)">

                        <source type="image/webp" srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1600, height1600, 'webp', false) }}" media="(max-width: 1599px)">
                        <source srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1600, height1600, 'jpg', false) }}" media="(max-width: 1599px)">

                        <source type="image/webp" srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1800, height1800, 'webp', false) }}" media="(min-width: 1600px)">
                        <source srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1800, height1800, 'jpg', false) }}" media="(min-width: 1600px)">
                        {% else %}
                        <source type="image/webp" srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1400, height1400, 'webp', false) }}">
                        <source srcset="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 1400, height1400, 'jpg', false) }}">
                        {% endif %}
                        <img loading="lazy" src="{{ oViewConf.getDynamicImage(actCategory.getThumbUrl(), 375, height375, 'jpg', false) }}" alt="{{ actCategory.oxcategories__oxtitle.value }}" class="w-100 img-fluid">
                    </picture>
                {% else %}
                    <img loading="lazy" src="{{ actCategory.getThumbUrl() }}" alt="{{ actCategory.oxcategories__oxtitle.value }}" class="w-100 img-fluid">
                {% endif %}
            {% endif %}

            <div class="pop-header">
                {% set rsslinks = oView.getRssLinks() %}
                <h1{% if actCategory.oxcategories__oxthumb.value and actCategory.getThumbUrl() %} class="text-white"{% endif %}>
                    {{ oView.getTitle() }}
                    {% if rsslinks.activeCategory %}
                        <a class="rss" id="rssActiveCategory" aria-label="{{ rsslinks.activeCategory.title }}" href="{{ rsslinks.activeCategory.link }}" title="{{ rsslinks.activeCategory.title }}" target="_blank">
                            <i class="moga-rss"></i>
                        </a>
                    {% endif %}
                </h1>
                {% if actCategory and actCategory.getShortDescription() and oPageNavigation.actPage == 1 and actCategory.oxcategories__oxdesc.rawValue %}
                <div id="catDescLocator" class="categoryDescription{% if actCategory.oxcategories__oxthumb.value and actCategory.getThumbUrl() %} text-white{% endif %}">
                    {{ actCategory.oxcategories__oxdesc.rawValue }}
                </div>
                {% endif %}

                {% if showPopBreadcrump %}
                <div class="breadcrumb-wrapper">
                    <div class="container-xxl pt-3">
                        {% include "widget/breadcrumb.html.twig" %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        {% if headerImageWidth == 'container' %}
        </div>
        {% endif %}
    {% endif %}

    {% if actCategory.oxcategories__oxlongdesc.value and oPageNavigation.actPage == 1 and sCategoryDescPosition == 'top' %}
        {% block page_list_long_desc %}
        <div id="catLongDescLocator" class="container-{% if headerImageWidth == 'container' %}fluid{% else %}xxl{% endif %} categoryDescription">
            {{ include(template_from_string(actCategory.oxcategories__oxlongdesc)) }}
        </div>
        {% endblock %}
    {% endif %}

    {% if oView.hasVisibleSubCats() %}
        <div class="container-{% if headerImageWidth == 'container' %}fluid{% else %}xxl{% endif %}">
            {% set iSubCategoriesCount = 0 %}
            <div class="my-3">
                <div class="row g-2">
                    {% for category in oView.getSubCatList() %}
                        {% if category.getContentCats() %}
                            {% for ocont in category.getContentCats() %}
                                <div class="col-12 col-sm-4 col-md-3 col-xl-2">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <a href="{{ ocont.getLink() }}">{{ ocont.oxcontents__oxtitle.value }}</a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}

                        {% if category.getIsVisible() %}
                            {% set iSubCategoriesCount = iSubCategoriesCount+1 %}
                            {% set iconUrl = category.getIconUrl() %}
                            <div class="col-12 col-sm-4 col-md-3{% if listType=='manufacturer' %} col-lg-2 manufacturer-item{% endif %}">
                                <a href="{{ category.getLink() }}" class="card {% if listType=='manufacturer' %}bg-light{% else %}bg-dark text-white{% endif %}">
                                    {% if iconUrl %}
                                        {% if oViewConf.isModuleActive('cnc / imagebutler') %}
                                            <img loading="lazy" src="{{ oViewConf.getDynamicImage(category.getIconUrl(), 400, 200, 'webp', false) }}" alt="{{ category.oxcategories__oxtitle.value }}" class="card-img">
                                        {% else %}
                                            <img loading="lazy" src="{{ category.getIconUrl() }}" alt="{{ category.oxcategories__oxtitle.value }}" class="card-img">
                                        {% endif %}
                                    {% else %}
                                            <img loading="lazy" src="{{ oViewConf.getImageUrl('subcat - placeholder.png') }}" alt="{{ category.oxcategories__oxtitle.value }}" class="card-img">
                                    {% endif %}
                                    <div class="card-img-overlay">
                                        <div class="h5 card-title">{{ category.oxcategories__oxtitle.value }}</div>
                                        {# if oView.showCategoryArticlesCount() and (category.getNrOfArticles() > 0) }} ({{ category.getNrOfArticles() }}){% endif %}
                                        {% if category.getHasVisibleSubCats() %}
                                        <ul class="list-unstyled">
                                            {% for subcategory in category.getSubCats() %}
                                            {% if subcategory.getIsVisible() %}
                                            {% for ocont in subcategory.getContentCats() %}
                                            <li>
                                                <a href="{{ ocont.getLink() }}"><strong>{{ ocont.oxcontents__oxtitle.value }}</strong></a>
                                            </li>
                                            {% endfor %}

                                            <li>
                                                <a href="{{ subcategory.getLink() }}">{{ subcategory.oxcategories__oxtitle.value }}</a>
                                                {% if oView.showCategoryArticlesCount() and (subcategory.getNrOfArticles() > 0) %}&nbsp;({{ subcategory.getNrOfArticles() }}){% endif %}
                                            </li>
                                            {% endif %}
                                            {% endfor %}
                                        </ul>
                                        {{ /if #}
                                    </div>
                                </a>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}

    {% endblock %}


    {% block page_list_listbody %}
        {% if oView.getArticleList() %}

            {% set categoryWidth = oViewConf.getViewThemeParam('sCategoryWidth') %}
            {% if categoryWidth == 'container' %}
                <div class="container-xxl">
            {% endif %}
                    <div class="article-list pb-5">
                        <div class="container{% if categoryWidth == 'w100cContainer' %}-xxl{% else %}-fluid{% endif %}">
                            {% if oView.getArticleList() %}
                                <div class="d-flex py-3">
                                    <button type="button" class="btn btn-outline-primary btn-icon" data-bs-toggle="modal" data-bs-target="#filter" aria-label="{{ translate({ ident: "DD_LISTLOCATOR_FILTER_ATTRIBUTES" }) }}">
                                        <i class="moga-sliders"></i>
                                    </button>

                                    <div class="sidebar-display ms-auto">
                                        {% block page_list_upperlocator %}
                                            {% include "widget/locator/listlocator.html.twig" with {locator: oView.getPageNavigationLimitedTop(), attributes: false, listDisplayType: true, sort: true, itemsPerPage: true} %}
                                        {% endblock %}
                                    </div>
                                </div>
                            {% endif %}
                            <div class="row">
                                {% if oView.getArticleList() %}
                                    {# List types: grid|line #}
                                    {% block page_list_productlist %}
                                        {% include "widget/product/list.html.twig" with {type: oView.getListDisplayType(), listId: "productList", products: oView.getArticleList()} %}
                                    {% endblock %}
                                    {% block page_list_bottomlocator %}
                                        {% include "widget/locator/listlocator.html.twig" with {locator: oView.getPageNavigationLimitedBottom(), place: "bottom"} %}
                                    {% endblock %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

            {% if categoryWidth == 'container' %}
                </div>
            {% endif %}
        {% endif %}
    {% endblock %}

    {% if actCategory.oxcategories__oxlongdesc.value and oPageNavigation.actPage == 1 and sCategoryDescPosition == 'bottom' %}
        {% block page_list_long_desc_bottom %}
            <div id="catLongDescLocator" class="container-{% if headerImageWidth == 'container' %}fluid{% else %}xxl{% endif %} categoryDescription">
                {{ include(template_from_string(actCategory.oxcategories__oxlongdesc)) }}
            </div>
        {% endblock %}
    {% endif %}

    <div class="modal fade modal-sidebar-left" id="filter">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    {% if oView.getArticleList() %}
                    {% block page_list_upperlocator_sidebar %}
                    {% include "widget/locator/listlocator.html.twig" with {locator: oView.getPageNavigationLimitedTop(), attributes: oView.getAttributes(), listDisplayType: false, sort: false} %}
                    {% endblock %}
                    {% endif %}

                    {{ include_widget({ cl: "oxwCategoryTree", cnid: oView.getCategoryId(), deepLevel: 0, noscript: 1, nocookie: 1 }) }}
                </div>
            </div>
        </div>
    </div>
{% endcapture %}
{% include "layout/page.html.twig" with {tree_path: oView.getTreePath()} %}
