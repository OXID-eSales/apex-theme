{% block widget_product_listitem_grid %}
    {% set product = oView.getProduct() %}
    {% set blDisableToCart = oView.getDisableToCart() %}
    {% set iIndex = oView.getIndex() %}
    {% set showMainLink = oView.getShowMainLink() %}
    {% set currency = oView.getActCurrency() %}
    {% set oUnitPrice = product.getUnitPrice() %}
    {% set tprice = product.getTPrice() %}
    {% set price = product.getPrice() %}
    {% if showMainLink %}
        {% set _productLink = product.getMainLink() %}
    {% else %}
        {% set _productLink = product.getLink() %}
    {% endif %}
    {% set aVariantSelections = product.getVariantSelections("null", "null", 1) %}
    {% set blShowToBasket = true %} {# tobasket or more info ? #}
    {% if blDisableToCart or product.isNotBuyable() or (aVariantSelections and aVariantSelections.selections) or product.hasMdVariants() or (oViewConf.showSelectListsInList() and product.getSelections(1)) or product.getVariants() %}
        {% set blShowToBasket = false %}
    {% endif %}

    <div class="card product-card">
        {% block widget_product_listitem_grid_gridpicture %}
        <div class="product-img-wrapper">

            <img loading="lazy" width="350" height="220" src="{{ product.getThumbnailUrl() }}" alt="{{ product.oxarticles__oxtitle.value }} {{ product.oxarticles__oxvarselect.value }}" class="product-img">
            {% if product.getMasterZoomPictureUrl(2) %}
                <picture>
                    <source type="image/webp" srcset="{{ product.getMasterZoomPictureUrl(2) }}" media="(min-width: 1024px)">
                    <img class="product-img img-2" width="350" height="220" loading="lazy" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="{{ product.oxarticles__oxtitle.value }} {{ product.oxarticles__oxvarselect.value }}">
                </picture>
            {% endif %}
            <a href="{{ _productLink }}" class="stretched-link"></a>


            {# TODO: We should have an attribute here #}
            {% if tprice and tprice.getBruttoPrice() > price.getBruttoPrice() %}
                <div class="badges">
                    <div class="badge bg-danger">sale</div>
                </div>
            {% endif %}

            {% block widget_product_listitem_grid_tobasket %}
                <div class="actions d-none d-lg-block">
                    <div class="bottom">
                        {% if blShowToBasket %}
                            {% hasrights { ident: "TOBASKET" } %}
                                <form name="tobasket{{ testid }}" {% if blShowToBasket %}action="{{ oViewConf.getSelfActionLink() }}" method="post"{% else %}action="{{ _productLink }}" method="get"{% endif %}>
                                    <div class="d-none">
                                        {{ oViewConf.getNavFormParams()|raw }}
                                        {{ oViewConf.getHiddenSid()|raw }}
                                        <input type="hidden" name="pgNr" value="{{ oView.getActPage() }}">
                                        {% if recommid %}
                                            <input type="hidden" name="recommid" value="{{ recommid }}">
                                        {% endif %}
                                        {% if blShowToBasket %}
                                            {% hasrights { ident: "TOBASKET" } %}
                                                <input type="hidden" name="cl" value="{{ oViewConf.getTopActiveClassName() }}">
                                                {% if owishid %}
                                                    <input type="hidden" name="owishid" value="{{ owishid }}">
                                                {% endif %}
                                                {% if toBasketFunction %}
                                                    <input type="hidden" name="fnc" value="{{ toBasketFunction }}">
                                                {% else %}
                                                    <input type="hidden" name="fnc" value="tobasket">
                                                {% endif %}
                                                <input type="hidden" name="aid" value="{{ product.oxarticles__oxid.value }}">
                                                {% if altproduct %}
                                                    <input type="hidden" name="anid" value="{{ altproduct }}">
                                                {% else %}
                                                    <input type="hidden" name="anid" value="{{ product.oxarticles__oxnid.value }}">
                                                {% endif %}
                                            {% endhasrights %}
                                        {% else %}
                                            <input type="hidden" name="cl" value="details">
                                            <input type="hidden" name="anid" value="{{ product.oxarticles__oxnid.value }}">
                                        {% endif %}
                                    </div>

                                    <div class="input-group">
                                        <input type="number" class="form-control" name="am" value="1" aria-label="{{ translate({ ident: "QUANTITY" }) }}" aria-describedby="submit{{ testid }}">
                                        <button type="submit" id="submit{{ testid }}" class="btn btn-highlight">
                                            {{ translate({ ident: "TO_CART" }) }}
                                        </button>
                                    </div>

                                </form>
                            {% endhasrights %}
                        {% else %}
                            <a class="btn btn-secondary w-100" href="{{ _productLink }}">{{ translate({ ident: "DETAILS" }) }}</a>
                        {% endif %}
                    </div>
                    <div class="right">
                        <a href="#" class="btn btn-outline-primary bg-todo">
                            <svg>
                                <use xlink:href="#eye-fill"></use>
                            </svg>
                        </a>
                        <a href="#" class="btn btn-outline-primary bg-todo">
                            <svg>
                                <use xlink:href="#star"></use>
                            </svg>
                        </a>
                    </div>
                </div>
            {% endblock %}
        </div>
        {% endblock %}

        <div class="card-body">
            <div class="d-flex justify-content-between">
                {% block widget_product_listitem_infogrid_titlebox %}
                    <div class="h5 card-title">
                        {{ product.oxarticles__oxtitle.value|raw }} {{ product.oxarticles__oxvarselect.value }}
                    </div>
                {% endblock %}
                <div class="d-flex flex-column price h5{% if tprice and tprice.getBruttoPrice() > price.getBruttoPrice() %} sale{% endif %}">
                    {% block widget_product_listitem_grid_price %}
                        {% hasrights { ident: "SHOWARTICLEPRICE" } %}
                            {% if tprice and tprice.getBruttoPrice() > price.getBruttoPrice() %}
                                <span class="oldPrice text-muted">
                                <del>{{ product.getFTPrice() }} {{ currency.sign }}</del>
                            </span>
                            {% endif %}

                            {% block widget_product_listitem_grid_price_value %}
                                {% if product.getFPrice() %}
                                    <span class="text-nowrap{% if tprice and tprice.getBruttoPrice() > price.getBruttoPrice() %} text-danger{% endif %}">
                                    {% if product.isRangePrice() %}
                                        {{ translate({ ident: "PRICE_FROM" }) }}
                                        {% if not product.isParentNotBuyable() %}
                                            {{ product.getFMinPrice() }}
                                        {% else %}
                                            {{ product.getFVarMinPrice() }}
                                        {% endif %}
                                    {% else %}
                                        {% if not product.isParentNotBuyable() %}
                                            {{ product.getFPrice() }}
                                        {% else %}
                                            {{ product.getFVarMinPrice() }}
                                        {% endif %}
                                    {% endif %}
                                        {{ currency.sign }}
                                </span>
                                {% endif %}
                            {% endblock %}
                            {% if oUnitPrice %}
                                <span id="productPricePerUnit_{{ testid }}" class="pricePerUnit">
                                    {{ product.oxarticles__oxunitquantity.value }} {{ product.getUnitName() }} | {{ format_price(oUnitPrice, { currency: currency }) }}/{{ product.getUnitName() }}
                            </span>
                            {% elseif product.oxarticles__oxweight.value and config.getConfigParam('blShowWeightInList')  %}
                                <span id="productPricePerUnit_Weight_{{ testid }}" class="pricePerUnit">
                                    <span title="weight">{{ translate({ ident: "WEIGHT" }) }}</span>
                                    <span class="value">{{ product.oxarticles__oxweight.value }} {{ translate({ ident: "KG" }) }}</span>
                            </span>
                            {% endif %}
                        {% endhasrights %}
                    {% endblock %}
                </div>
            </div>
            <div class="short-desc">
                {{ product.oxarticles__oxshortdesc.value }}
            </div>
            <a href="{{ _productLink }}" class="stretched-link" aria-label="{{ translate({ ident: "DETAILS" }) }}"></a>
        </div>
    </div>
{% endblock %}
