document.addEventListener("DOMContentLoaded",function(){addBasketAmountEventlisteners()},!1);let addBasketAmountEventlisteners=function(){var aAmountButtons=document.querySelectorAll(".js-amount button"),aAmountInputs=document.querySelectorAll('input[name^="aproducts"][name$="[am]"]'),aRemoveButtons=document.querySelectorAll("#basket_form .js-remove"),productLabelInputs=document.querySelectorAll("#basket_form .persParam");aAmountButtons&&aAmountButtons.forEach(btn=>{btn.addEventListener("click",function(evt){evt.preventDefault(),mode=btn.classList.contains("js-decreaseAmount")?"sub":"add",changeInputAmount(btn,mode)})}),aAmountInputs&&aAmountInputs.forEach(input=>{input.addEventListener("change",function(evt){evt.preventDefault(),changeInputAmountAjax()})}),aRemoveButtons&&aRemoveButtons.forEach(btn=>{btn.addEventListener("click",function(evt){evt.preventDefault();evt=btn.closest(".basketitemrow").querySelector('input[name^="aproducts"][name$="[am]"]');evt.value=0,evt.dispatchEvent(new Event("change"))})}),productLabelInputs&&productLabelInputs.forEach(input=>{input.addEventListener("change",function(evt){evt.preventDefault(),updateProductLabel(input)})})},changeInputAmount=function(button,mode){let amountWrapper=button.closest(".js-amount");if(amountWrapper){let amountInput=amountWrapper.querySelector('input[name^="aproducts"][name$="[am]"]');amountInput&&("sub"===mode&&(amountInput.value=Math.max(0,parseInt(amountInput.value,10)-1)),"add"===mode&&(amountInput.value=parseInt(amountInput.value,10)+1),debounceCall(function(){addLoadingSpinner(amountWrapper.closest(".list-group-item")),amountInput.dispatchEvent(new Event("change"))},350))}},updateProductLabel=function(input){debounceCall(function(){var row=input.closest(".basketitemrow");row&&addLoadingSpinner(row),changeInputAmountAjax()},350)},addLoadingSpinner=function(row){var nLoadingSpinner=(new DOMParser).parseFromString('<div style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 10; --bs-bg-opacity: .75;" class="loadingShadowMinibasket bg-secondary"><div class="spinner-border text-primary"><span class="visually-hidden">Loading...</span></div></div>',"text/html").body.querySelector(".loadingShadowMinibasket");row.prepend(nLoadingSpinner)},changeInputAmountAjax=function(){var data=new FormData(document.getElementById("basket_form"));fetch("/index.php",{method:"POST",body:data}).then(function(response){return response.ok?response.text():Promise.reject(response)}).then(function(response){response=(new DOMParser).parseFromString(response,"text/html").body;document.querySelector("body").replaceWith(response),addBasketAmountEventlisteners(),dispatchEvent(new Event("basketLoaded"))}).catch(function(error){console.log(error)})},debounceCall=(()=>{let timer=0;return function(callback,ms){clearTimeout(timer),timer=setTimeout(callback,ms)}})();